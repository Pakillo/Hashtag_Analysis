---
title: "TweetsReport"
author: "Aitor Ameztegui"
date: "September 8, 2016"
output:
  html_document: default
  pdf_document: default
---

 
```{r, echo=FALSE, results='hide', message=FALSE}

dt_tweets <- read.csv(file = "cronica_tweets.csv",stringsAsFactors = FALSE)
dt_tweets$created <- as.Date(dt_tweets$created)

library(dplyr)
library(ggplot2)
library(knitr)
library(tidyr)
library(wesanderson)
```

## Sobre este documento
Este documento ha sido producido por [Aitor Ameztegui](http://ameztegui.weebly.com) ([multivac42](https://twitter.com/multivac42) en Twitter).

El codigo para generar el documento fue desarrollado originalmente por [Francois Michonneau](https://github.com/fmichonneau) ([fmic_](https://twitter.com/fmic_) enn Twitter) para el congreso de Evolucion de 2015, y se puede encontrar [aqui](https://github.com/fmichonneau/evol2015-tweets). El codigo ha sido posteriormente  por [modificado](https://github.com/jlehtoma/iccb2015-tweets/blob/gh-pages/index.Rmd) para el congreso ICCB-ECCB 2015 por Joona Lehtomaki ([jlehtoma](https://twitter.com/jlehtoma) en Twitter), y por [Emily J. Rollinson](http://rollinsonecology.com) ([ejrollinson](https://twitter.com/ejrollinson) en Twitter), para los congresos de la Ecological Society of America de 2015 (Baltimore, #ESA100), y de 2016 (Fort Lauderdale, Florida, #ESA2016). También he incorporado algunos elementos del análisis que hizo [Keith H.Turner](http://twitter.com/kay_aych) para el [ISME2016](https://github.com/khturner/HashtagISME16).

Los tweets que incluian el hashtag #7CFE se recopilaron de twitter mediante el paquete de R [twitteR](https://cran.r-project.org/web/packages/twitteR/index.html) a partir de la API de Twitter. El documento se genero mediante RMarkdown, y el codigo fuente estan
 [disponibles en my GitHub](https://github.com/ameztegui/Hashtag_Analysis). El documento, asi como el codigo asociado tienen una [licencia CC0](https://creativecommons.org/choose/zero/?lang=es_ES).


## Resumen

De los ### tweets generados con el hashtag #7CFE durante la semana de celebracion del & Congreso Forestal Espanol en Plasencia (Caceres):

|Descripcion | n |
|------------|---|
|Numero total de tweets originales (sin contar retweets): | `r sum(!dt_tweets$isRetweet)`|
|Numeros de usuarios que han tuiteado: | `r length(unique(dt_tweets$screenName))`|



## Los 5 tweets mas marcados como favoritos:

```{r top-fav, echo=FALSE, results='asis'}
top_fav <- dt_tweets %>%
  filter(!isRetweet) %>%
  arrange(desc(favoriteCount)) %>%
  slice(1:5)


render_tweet <- function(dt, row) {
    screen_name <- dt[i, "screenName"]
    id <- format(dt[i, "id"], scientific = FALSE)
    txt <- dt[i, "text"]
    created <- format(dt[i, "created"], "%Y-%m-%d")
    n_fav <- dt[i, "favoriteCount"]
    n_retweets <- dt[i, "retweetCount"]
    cat("<blockquote class=\"twitter-tweet\" lang=\"en\"> \n",
        "<p lang=\"en\" dir=\"ltr\">",
        txt,
        "</p>&mdash; ",
        "<a href=\"https://twitter.com/", screen_name, "\">", screen_name, "</a>", "&nbsp;|&nbsp;",
        "<a href=\"https://twitter.com/",
        screen_name, "/status/", id, "\"> ", created, "</a> &nbsp;|&nbsp;",
        n_retweets, " retweets, ",  n_fav, " favorites. </blockquote>",
        "\n \n",
        sep = "")
}

for (i in seq_len(nrow(top_fav))) {
    render_tweet(top_fav, i)
}


```


## Los 5 tweets mas retuiteados:

```{r top-rt, echo=FALSE, results='asis'}
top_rt <- dt_tweets %>%
  filter(!isRetweet) %>%
  filter(!screenName %in% c('meeting_goer')) %>%
  arrange(desc(retweetCount)) %>%
  slice(1:5)

for (i in seq_len(nrow(top_fav))) {
    render_tweet(top_rt, i)
}

```

## Tuiteros mas activos

Todos los tweets (incluyendo retuits)

```{r top-users-all, echo=FALSE, fig.height=10}
top_users <- dt_tweets %>% group_by(screenName) %>%
  filter(!screenName %in% c('meeting_goer')) %>%
  summarize(total_tweets = n(),
            Retweet = sum(isRetweet),
            Original = sum(!isRetweet)) %>%
  arrange(desc(total_tweets)) %>%
  slice(1:50) %>%
  gather(type, n_tweets, -screenName, -total_tweets)

top_users$screenName <- reorder(top_users$screenName,
                                top_users$total_tweets,
                                function(x) sum(x))

ggplot(top_users) + geom_bar(aes(x = screenName, y = n_tweets, fill = type),
                             stat = "identity") +
  ylab("Numero de tweets") + xlab("Usuario") +
  coord_flip() +
  scale_fill_manual(values = wes_palette("Zissou")[c(1, 3)]) +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))
```

Solo tweets originales (excluyendo retuits)

```{r, top-users-orig, echo=FALSE, fig.height=10}
top_orig_users <- dt_tweets %>% group_by(screenName) %>%
  filter(!screenName %in% c('meeting_goer')) %>%
  summarize(total_tweets = n(),
            Retweet = sum(isRetweet),
            Original = sum(!isRetweet)) %>%
  arrange(desc(Original)) %>%
  slice(1:50)

top_orig_users$screenName <- reorder(top_orig_users$screenName,
                                     top_orig_users$Original,
                                     function(x) sum(x))

## png(file = "top_users2.png", width = 800, height = 800)
ggplot(top_orig_users) + geom_bar(aes(x = screenName, y = Original), stat = "identity",
                                  fill = wes_palette("Zissou", 1)) +
  ylab("Numero de tweets") + xlab("Usuario") +
  coord_flip() +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))
## dev.off()

```


## Usuarios que han recibido mas retuits/favoritos: 

Nota: las figuras de abajo solo incluyen usuarios que han tuiteado mas de 5 veces, y no incluyen retuits.

### Numero total de favoritos recibidos por los usuarios

```{r, fig.height=10, echo=FALSE}
impact <- dt_tweets %>% filter(!isRetweet) %>%
  group_by(screenName) %>%
  summarize(n_tweets = n(),
            n_fav = sum(favoriteCount),
            n_rt =  sum(retweetCount),
            mean_fav = mean(favoriteCount),
            mean_rt = mean(retweetCount)) %>%
  filter(n_tweets >=  5)

### Most favorited
most_fav <- impact %>%
  arrange(desc(n_fav)) %>%
  slice(1:50)

most_fav$screenName <- reorder(most_fav$screenName,
                               most_fav$n_fav,
                               sort)

ggplot(most_fav) + geom_bar(aes(x = screenName, y = n_fav),
                            stat = "identity", fill = wes_palette("Zissou")[2]) +
  coord_flip() + xlab("Usuario") + ylab("Numero total de favoritos") +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))
```

### Numero de retuits recibidos por los usuarios 

```{r, fig.height=10, echo=FALSE}
## Most retweeted

most_rt <- impact %>%
  arrange(desc(n_rt)) %>%
  slice(1:50)

most_rt$screenName <- reorder(most_rt$screenName,
                              most_rt$n_rt,
                              sort)

ggplot(most_rt) + geom_bar(aes(x = screenName, y = n_rt),
                           stat = "identity", fill = wes_palette("Zissou")[5]) +
  coord_flip() + xlab("Usuario") + ylab("Numero total de retweets") +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))
```

### Numero medio de favoritos recibidos 

```{r, fig.height=10, echo=FALSE}

### Mean favorites

hi_mean_fav <- impact %>%
  arrange(desc(mean_fav)) %>%
  slice(1:50)

hi_mean_fav$screenName <- reorder(hi_mean_fav$screenName,
                                  hi_mean_fav$mean_fav,
                                  sort)

ggplot(hi_mean_fav) + geom_bar(aes(x = screenName, y = mean_fav),
                           stat = "identity", fill = wes_palette("Zissou")[2]) +
  coord_flip() + xlab("Usuario") + ylab("Numero de favoritos / tweet") +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))

```

### Numero medio de retuits recibidos

```{r, fig.height=10, echo=FALSE}

### Mean retweets

hi_mean_rt <- impact %>%
  arrange(desc(mean_rt)) %>%
  slice(1:50)

hi_mean_rt$screenName <- reorder(hi_mean_rt$screenName,
                                 hi_mean_rt$mean_rt,
                                 sort)

ggplot(hi_mean_rt) + geom_bar(aes(x = screenName, y = mean_rt),
                           stat = "identity", fill = wes_palette("Zissou")[5]) +
  coord_flip() + xlab("User") + ylab("Numero de retuits/ tuit") +
  theme(axis.text = element_text(size = 12),
        legend.text = element_text(size = 12))


```

## Word cloud

Las 50 palabras mas frecuentes en los tweets etiquetados con #7CFE.

```{r word-cloud, echo=FALSE, message=FALSE}
library(wordcloud)

pal <- wes_palette("Darjeeling", 8, type = "continuous") #brewer.pal(8, "Dark2")

dt_tweets %>%
  filter(!isRetweet) %>%
  .$text %>% paste(collapse = "") %>%
  gsub("(@|\\#)\\w+", "", .) %>%  ## remove mentions/hashtags
  gsub("https?\\:\\/\\/\\w+\\.\\w+(\\/\\w+)*", "", .) %>% ## remove urls
  gsub("\\bthe\\b", "", .) %>% ## remove the
  gsub("amp", "", .) %>%  ## remove &
  gsub("\\bspp\\b", "species", .) %>% ## replace spp by species
  iconv(., from = "latin1", to = "UTF-8", sub = "") %>% ## remove emojis
  wordcloud(max.words = 50, colors = pal, random.order = FALSE, scale = c(3, .7))

```

-----

<p xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#">
  <a rel="license"
     href="http://creativecommons.org/publicdomain/zero/1.0/">
    <img src="http://i.creativecommons.org/p/zero/1.0/88x31.png" style="border-style: none;" alt="CC0" />
  </a>
  <br />
  To the extent possible under law,
  <a rel="dct:publisher"
     href="https://github.com/erollinson/erollinson.github.io">
    <span property="dct:title">Aitor Ameztegui</span></a>
  has waived all copyright and related or neighboring rights to
  <span property="dct:title">Summary of tweets at the 2016 Ecological Society of America conference</span>.
This work is published from:
<span property="vcard:Country" datatype="dct:ISO3166"
      content="ESP" about="https://github.com/erollinson/erollinson.github.io">
  Espana</span>.
</p>
